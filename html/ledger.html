<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>ledger</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="basicBitcoinDataType.html" class="Module">basicBitcoinDataType</a>

<a id="35" class="Keyword">module</a> <a id="42" href="ledger.html" class="Module">ledger</a> <a id="49" class="Symbol">(</a><a id="50" href="ledger.html#50" class="Bound">param</a> <a id="56" class="Symbol">:</a> <a id="58" href="basicBitcoinDataType.html#1169" class="Record">GlobalParameters</a><a id="74" class="Symbol">)</a> <a id="76" class="Keyword">where</a>

<a id="83" class="Keyword">open</a> <a id="88" class="Keyword">import</a> <a id="95" href="Data.Nat.html" class="Module">Data.Nat</a>  <a id="105" class="Keyword">hiding</a> <a id="112" class="Symbol">(</a><a id="113" href="Data.Nat.Base.html#1535" class="Datatype Operator">_≤_</a><a id="116" class="Symbol">)</a>
<a id="118" class="Keyword">open</a> <a id="123" class="Keyword">import</a> <a id="130" href="Data.List.html" class="Module">Data.List</a> <a id="140" class="Keyword">hiding</a> <a id="147" class="Symbol">(</a><a id="148" href="Data.List.Base.html#1810" class="Function Operator">_++_</a><a id="152" class="Symbol">)</a>
<a id="154" class="Keyword">open</a> <a id="159" class="Keyword">import</a> <a id="166" href="Data.Unit.html" class="Module">Data.Unit</a>  <a id="177" class="Keyword">hiding</a> <a id="184" class="Symbol">(</a><a id="185" href="Data.Unit.Base.html#1023" class="Record Operator">_≤_</a><a id="188" class="Symbol">)</a>
<a id="190" class="Keyword">open</a> <a id="195" class="Keyword">import</a> <a id="202" href="Data.Empty.html" class="Module">Data.Empty</a>
<a id="213" class="Keyword">open</a> <a id="218" class="Keyword">import</a> <a id="225" href="Data.Bool.html" class="Module">Data.Bool</a>  <a id="236" class="Keyword">hiding</a> <a id="243" class="Symbol">(</a><a id="244" href="Data.Bool.Base.html#672" class="Datatype Operator">_≤_</a> <a id="248" class="Symbol">;</a> <a id="250" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a> <a id="264" class="Symbol">)</a> <a id="266" class="Keyword">renaming</a> <a id="275" class="Symbol">(</a><a id="276" href="Data.Bool.Base.html#986" class="Function Operator">_∧_</a> <a id="280" class="Symbol">to</a> <a id="283" class="Function Operator">_∧b_</a> <a id="288" class="Symbol">;</a> <a id="290" href="Data.Bool.Base.html#1044" class="Function Operator">_∨_</a> <a id="294" class="Symbol">to</a> <a id="297" class="Function Operator">_∨b_</a> <a id="302" class="Symbol">;</a> <a id="304" href="Data.Bool.Base.html#1451" class="Function">T</a> <a id="306" class="Symbol">to</a> <a id="309" class="Function">True</a><a id="313" class="Symbol">)</a>
<a id="315" class="Keyword">open</a> <a id="320" class="Keyword">import</a> <a id="327" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="342" class="Keyword">hiding</a> <a id="349" class="Symbol">(</a><a id="350" href="Data.Bool.Base.html#672" class="Datatype Operator">_≤_</a> <a id="354" class="Symbol">;</a> <a id="356" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a> <a id="370" class="Symbol">)</a> <a id="372" class="Keyword">renaming</a> <a id="381" class="Symbol">(</a><a id="382" href="Data.Bool.Base.html#986" class="Function Operator">_∧_</a> <a id="386" class="Symbol">to</a> <a id="389" class="Function Operator">_∧b_</a> <a id="394" class="Symbol">;</a> <a id="396" href="Data.Bool.Base.html#1044" class="Function Operator">_∨_</a> <a id="400" class="Symbol">to</a> <a id="403" class="Function Operator">_∨b_</a> <a id="408" class="Symbol">;</a> <a id="410" href="Data.Bool.Base.html#1451" class="Function">T</a> <a id="412" class="Symbol">to</a> <a id="415" class="Function">True</a><a id="419" class="Symbol">)</a>
<a id="421" class="Keyword">open</a> <a id="426" class="Keyword">import</a> <a id="433" href="Data.Product.html" class="Module">Data.Product</a> <a id="446" class="Keyword">renaming</a> <a id="455" class="Symbol">(</a><a id="456" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a> <a id="460" class="Symbol">to</a> <a id="463" class="InductiveConstructor Operator">_,,_</a> <a id="468" class="Symbol">)</a>
<a id="470" class="Keyword">open</a> <a id="475" class="Keyword">import</a> <a id="482" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="496" class="Keyword">hiding</a> <a id="503" class="Symbol">(</a><a id="504" href="Data.Nat.Base.html#1535" class="Datatype Operator">_≤_</a><a id="507" class="Symbol">)</a>
<a id="509" class="Keyword">open</a> <a id="514" class="Keyword">import</a> <a id="521" href="Data.List.NonEmpty.html" class="Module">Data.List.NonEmpty</a> <a id="540" class="Keyword">hiding</a> <a id="547" class="Symbol">(</a><a id="548" href="Data.List.NonEmpty.Base.html#1141" class="Field">head</a><a id="552" class="Symbol">)</a>
<a id="554" class="Keyword">open</a> <a id="559" class="Keyword">import</a> <a id="566" href="Data.Maybe.html" class="Module">Data.Maybe</a>

<a id="578" class="Keyword">open</a> <a id="583" class="Keyword">import</a> <a id="590" href="libraries.listLib.html" class="Module">libraries.listLib</a>
<a id="608" class="Keyword">open</a> <a id="613" class="Keyword">import</a> <a id="620" href="libraries.natLib.html" class="Module">libraries.natLib</a>
<a id="637" class="Keyword">open</a> <a id="642" class="Keyword">import</a> <a id="649" href="libraries.boolLib.html" class="Module">libraries.boolLib</a>
<a id="667" class="Keyword">open</a> <a id="672" class="Keyword">import</a> <a id="679" href="libraries.andLib.html" class="Module">libraries.andLib</a>
<a id="696" class="Keyword">open</a> <a id="701" class="Keyword">import</a> <a id="708" href="libraries.maybeLib.html" class="Module">libraries.maybeLib</a>

<a id="728" class="Keyword">open</a> <a id="733" class="Keyword">import</a> <a id="740" href="stack.html" class="Module">stack</a>
<a id="746" class="Keyword">open</a> <a id="751" class="Keyword">import</a> <a id="758" href="instruction.html" class="Module">instruction</a>

<a id="771" class="Keyword">record</a> <a id="SignedWithSigPbk"></a><a id="778" href="ledger.html#778" class="Record">SignedWithSigPbk</a> <a id="795" class="Symbol">(</a><a id="796" href="ledger.html#796" class="Bound">msg</a> <a id="800" class="Symbol">:</a> <a id="802" href="basicBitcoinDataType.html#854" class="Datatype">Msg</a><a id="805" class="Symbol">)(</a><a id="807" href="ledger.html#807" class="Bound">address</a> <a id="815" class="Symbol">:</a> <a id="817" href="basicBitcoinDataType.html#714" class="Function">Address</a><a id="824" class="Symbol">)</a> <a id="826" class="Symbol">:</a> <a id="828" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="832" class="Keyword">where</a>
  <a id="840" class="Keyword">field</a>  <a id="SignedWithSigPbk.publicKey"></a><a id="847" href="ledger.html#847" class="Field">publicKey</a>  <a id="858" class="Symbol">:</a>  <a id="861" href="basicBitcoinDataType.html#799" class="Function">PublicKey</a>
         <a id="SignedWithSigPbk.pbkCorrect"></a><a id="880" href="ledger.html#880" class="Field">pbkCorrect</a> <a id="891" class="Symbol">:</a>  <a id="894" href="ledger.html#50" class="Bound">param</a> <a id="900" class="Symbol">.</a><a id="901" href="basicBitcoinDataType.html#1210" class="Field">publicKey2Address</a> <a id="919" href="ledger.html#847" class="Field">publicKey</a> <a id="929" href="libraries.natLib.html#547" class="Function Operator">≡ℕ</a>  <a id="933" href="ledger.html#807" class="Bound">address</a>
         <a id="SignedWithSigPbk.signature"></a><a id="950" href="ledger.html#950" class="Field">signature</a>  <a id="961" class="Symbol">:</a>  <a id="964" href="basicBitcoinDataType.html#767" class="Function">Signature</a>
         <a id="SignedWithSigPbk.signed"></a><a id="983" href="ledger.html#983" class="Field">signed</a>     <a id="994" class="Symbol">:</a>  <a id="997" href="basicBitcoinDataType.html#1372" class="Function">Signed</a> <a id="1004" href="ledger.html#50" class="Bound">param</a> <a id="1010" href="ledger.html#796" class="Bound">msg</a> <a id="1014" href="ledger.html#950" class="Field">signature</a> <a id="1024" href="ledger.html#847" class="Field">publicKey</a>


<a id="1036" class="Comment">-- record for the transaction field</a>
<a id="1072" class="Keyword">record</a> <a id="TXFieldNew"></a><a id="1079" href="ledger.html#1079" class="Record">TXFieldNew</a> <a id="1090" class="Symbol">:</a> <a id="1092" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1096" class="Keyword">where</a>
  <a id="1104" class="Keyword">constructor</a> <a id="txFieldNew"></a><a id="1116" href="ledger.html#1116" class="InductiveConstructor">txFieldNew</a>
  <a id="1129" class="Keyword">field</a>  <a id="TXFieldNew.amount"></a><a id="1136" href="ledger.html#1136" class="Field">amount</a>         <a id="1151" class="Symbol">:</a>  <a id="1154" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
         <a id="TXFieldNew.address"></a><a id="1165" href="ledger.html#1165" class="Field">address</a>        <a id="1180" class="Symbol">:</a>  <a id="1183" href="basicBitcoinDataType.html#714" class="Function">Address</a>
         <a id="TXFieldNew.smartContract"></a><a id="1200" href="ledger.html#1200" class="Field">smartContract</a>  <a id="1215" class="Symbol">:</a> <a id="1217" href="instruction.html#1859" class="Function">BitcoinScript</a>

<a id="1232" class="Keyword">open</a> <a id="1237" href="ledger.html#1079" class="Module">TXFieldNew</a> <a id="1248" class="Keyword">public</a>




<a id="txField2MsgNew"></a><a id="1259" href="ledger.html#1259" class="Function">txField2MsgNew</a> <a id="1274" class="Symbol">:</a> <a id="1276" class="Symbol">(</a><a id="1277" href="ledger.html#1277" class="Bound">inp</a> <a id="1281" class="Symbol">:</a> <a id="1283" href="ledger.html#1079" class="Record">TXFieldNew</a><a id="1293" class="Symbol">)</a> <a id="1295" class="Symbol">→</a> <a id="1297" href="basicBitcoinDataType.html#854" class="Datatype">Msg</a>
<a id="1301" href="ledger.html#1259" class="Function">txField2MsgNew</a> <a id="1316" href="ledger.html#1316" class="Bound">inp</a>  <a id="1321" class="Symbol">=</a>   <a id="1325" href="basicBitcoinDataType.html#873" class="InductiveConstructor">nat</a> <a id="1329" class="Symbol">(</a><a id="1330" href="ledger.html#1136" class="Field">amount</a> <a id="1337" href="ledger.html#1316" class="Bound">inp</a><a id="1340" class="Symbol">)</a> <a id="1342" href="basicBitcoinDataType.html#907" class="InductiveConstructor Operator">+msg</a> <a id="1347" href="basicBitcoinDataType.html#873" class="InductiveConstructor">nat</a> <a id="1351" class="Symbol">(</a><a id="1352" href="ledger.html#1165" class="Field">address</a> <a id="1360" href="ledger.html#1316" class="Bound">inp</a><a id="1363" class="Symbol">)</a>



<a id="txFieldList2MsgNew"></a><a id="1368" href="ledger.html#1368" class="Function">txFieldList2MsgNew</a> <a id="1387" class="Symbol">:</a> <a id="1389" class="Symbol">(</a><a id="1390" href="ledger.html#1390" class="Bound">inp</a> <a id="1394" class="Symbol">:</a> <a id="1396" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1401" href="ledger.html#1079" class="Record">TXFieldNew</a><a id="1411" class="Symbol">)</a> <a id="1413" class="Symbol">→</a> <a id="1415" href="basicBitcoinDataType.html#854" class="Datatype">Msg</a>
<a id="1419" href="ledger.html#1368" class="Function">txFieldList2MsgNew</a> <a id="1438" href="ledger.html#1438" class="Bound">inp</a>  <a id="1443" class="Symbol">=</a> <a id="1445" href="basicBitcoinDataType.html#944" class="InductiveConstructor">list</a> <a id="1450" class="Symbol">(</a><a id="1451" href="libraries.listLib.html#857" class="Function">mapL</a> <a id="1456" href="ledger.html#1259" class="Function">txField2MsgNew</a> <a id="1471" href="ledger.html#1438" class="Bound">inp</a><a id="1474" class="Symbol">)</a>


<a id="txFieldList2TotalAmountNew"></a><a id="1478" href="ledger.html#1478" class="Function">txFieldList2TotalAmountNew</a> <a id="1505" class="Symbol">:</a> <a id="1507" class="Symbol">(</a><a id="1508" href="ledger.html#1508" class="Bound">inp</a> <a id="1512" class="Symbol">:</a> <a id="1514" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1519" href="ledger.html#1079" class="Record">TXFieldNew</a><a id="1529" class="Symbol">)</a> <a id="1531" class="Symbol">→</a> <a id="1533" href="basicBitcoinDataType.html#688" class="Function">Amount</a>
<a id="1540" href="ledger.html#1478" class="Function">txFieldList2TotalAmountNew</a> <a id="1567" href="ledger.html#1567" class="Bound">inp</a> <a id="1571" class="Symbol">=</a> <a id="1573" href="libraries.listLib.html#7885" class="Function">sumListViaf</a> <a id="1585" href="ledger.html#1136" class="Field">amount</a> <a id="1592" href="ledger.html#1567" class="Bound">inp</a>



<a id="1599" class="Comment">-- record for unsigned transaction</a>
<a id="1634" class="Keyword">record</a> <a id="TXUnsignedNew"></a><a id="1641" href="ledger.html#1641" class="Record">TXUnsignedNew</a> <a id="1655" class="Symbol">:</a> <a id="1657" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1661" class="Keyword">where</a>
  <a id="1669" class="Keyword">field</a>  <a id="TXUnsignedNew.inputs"></a><a id="1676" href="ledger.html#1676" class="Field">inputs</a>   <a id="1685" class="Symbol">:</a> <a id="1687" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1692" href="ledger.html#1079" class="Record">TXFieldNew</a>
         <a id="TXUnsignedNew.outputs"></a><a id="1712" href="ledger.html#1712" class="Field">outputs</a>  <a id="1721" class="Symbol">:</a> <a id="1723" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1728" href="ledger.html#1079" class="Record">TXFieldNew</a>
         <a id="TXUnsignedNew.TXID1"></a><a id="1748" href="ledger.html#1748" class="Field">TXID1</a>     <a id="1758" class="Symbol">:</a> <a id="1760" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
<a id="1762" class="Keyword">open</a> <a id="1767" href="ledger.html#1641" class="Module">TXUnsignedNew</a> <a id="1781" class="Keyword">public</a>




<a id="txUnsigned2MsgNew"></a><a id="1792" href="ledger.html#1792" class="Function">txUnsigned2MsgNew</a> <a id="1810" class="Symbol">:</a>  <a id="1813" class="Symbol">(</a><a id="1814" href="ledger.html#1814" class="Bound">transac</a> <a id="1822" class="Symbol">:</a> <a id="1824" href="ledger.html#1641" class="Record">TXUnsignedNew</a><a id="1837" class="Symbol">)</a> <a id="1839" class="Symbol">→</a> <a id="1841" href="basicBitcoinDataType.html#854" class="Datatype">Msg</a>
<a id="1845" href="ledger.html#1792" class="Function">txUnsigned2MsgNew</a> <a id="1863" href="ledger.html#1863" class="Bound">transac</a> <a id="1871" class="Symbol">=</a> <a id="1873" href="ledger.html#1368" class="Function">txFieldList2MsgNew</a> <a id="1892" class="Symbol">(</a><a id="1893" href="ledger.html#1676" class="Field">inputs</a> <a id="1900" href="ledger.html#1863" class="Bound">transac</a><a id="1907" class="Symbol">)</a>  <a id="1910" href="basicBitcoinDataType.html#907" class="InductiveConstructor Operator">+msg</a> <a id="1915" href="ledger.html#1368" class="Function">txFieldList2MsgNew</a> <a id="1934" class="Symbol">(</a><a id="1935" href="ledger.html#1712" class="Field">outputs</a> <a id="1943" href="ledger.html#1863" class="Bound">transac</a><a id="1950" class="Symbol">)</a>




<a id="txInput2MsgNew"></a><a id="1956" href="ledger.html#1956" class="Function">txInput2MsgNew</a> <a id="1971" class="Symbol">:</a> <a id="1973" class="Symbol">(</a><a id="1974" href="ledger.html#1974" class="Bound">inp</a> <a id="1978" class="Symbol">:</a> <a id="1980" href="ledger.html#1079" class="Record">TXFieldNew</a><a id="1990" class="Symbol">)(</a><a id="1992" href="ledger.html#1992" class="Bound">outp</a> <a id="1997" class="Symbol">:</a> <a id="1999" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="2004" href="ledger.html#1079" class="Record">TXFieldNew</a><a id="2014" class="Symbol">)</a> <a id="2016" class="Symbol">→</a> <a id="2018" href="basicBitcoinDataType.html#854" class="Datatype">Msg</a>
<a id="2022" href="ledger.html#1956" class="Function">txInput2MsgNew</a> <a id="2037" href="ledger.html#2037" class="Bound">inp</a> <a id="2041" href="ledger.html#2041" class="Bound">outp</a> <a id="2046" class="Symbol">=</a> <a id="2048" href="ledger.html#1259" class="Function">txField2MsgNew</a> <a id="2063" href="ledger.html#2037" class="Bound">inp</a> <a id="2067" href="basicBitcoinDataType.html#907" class="InductiveConstructor Operator">+msg</a> <a id="2072" href="ledger.html#1368" class="Function">txFieldList2MsgNew</a> <a id="2091" href="ledger.html#2041" class="Bound">outp</a>

<a id="tx2SignauxNew"></a><a id="2097" href="ledger.html#2097" class="Function">tx2SignauxNew</a> <a id="2111" class="Symbol">:</a> <a id="2113" class="Symbol">(</a><a id="2114" href="ledger.html#2114" class="Bound">inp</a> <a id="2118" class="Symbol">:</a> <a id="2120" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="2125" href="ledger.html#1079" class="Record">TXFieldNew</a><a id="2135" class="Symbol">)</a> <a id="2137" class="Symbol">(</a><a id="2138" href="ledger.html#2138" class="Bound">outp</a> <a id="2143" class="Symbol">:</a> <a id="2145" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="2150" href="ledger.html#1079" class="Record">TXFieldNew</a><a id="2160" class="Symbol">)</a>  <a id="2163" class="Symbol">→</a> <a id="2165" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="2169" href="ledger.html#2097" class="Function">tx2SignauxNew</a> <a id="2183" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>               <a id="2200" href="ledger.html#2200" class="Bound">outp</a>  <a id="2206" class="Symbol">=</a> <a id="2208" href="Agda.Builtin.Unit.html#164" class="Record">⊤</a>
<a id="2210" href="ledger.html#2097" class="Function">tx2SignauxNew</a> <a id="2224" class="Symbol">(</a><a id="2225" href="ledger.html#2225" class="Bound">inp</a> <a id="2229" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="2231" href="ledger.html#2231" class="Bound">restinp</a><a id="2238" class="Symbol">)</a>  <a id="2241" href="ledger.html#2241" class="Bound">outp</a>  <a id="2247" class="Symbol">=</a>
    <a id="2253" href="ledger.html#778" class="Record">SignedWithSigPbk</a> <a id="2270" class="Symbol">(</a><a id="2271" href="ledger.html#1956" class="Function">txInput2MsgNew</a> <a id="2286" href="ledger.html#2225" class="Bound">inp</a> <a id="2290" href="ledger.html#2241" class="Bound">outp</a><a id="2294" class="Symbol">)</a> <a id="2296" class="Symbol">(</a><a id="2297" href="ledger.html#1165" class="Field">address</a> <a id="2305" href="ledger.html#2225" class="Bound">inp</a><a id="2308" class="Symbol">)</a> <a id="2310" href="Data.Product.html#1167" class="Function Operator">×</a>  <a id="2313" href="ledger.html#2097" class="Function">tx2SignauxNew</a> <a id="2327" href="ledger.html#2231" class="Bound">restinp</a> <a id="2335" href="ledger.html#2241" class="Bound">outp</a>




<a id="tx2SignNew"></a><a id="2344" href="ledger.html#2344" class="Function">tx2SignNew</a> <a id="2355" class="Symbol">:</a> <a id="2357" href="ledger.html#1641" class="Record">TXUnsignedNew</a> <a id="2371" class="Symbol">→</a> <a id="2373" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="2377" href="ledger.html#2344" class="Function">tx2SignNew</a> <a id="2388" href="ledger.html#2388" class="Bound">tr</a> <a id="2391" class="Symbol">=</a> <a id="2393" href="ledger.html#2097" class="Function">tx2SignauxNew</a> <a id="2407" class="Symbol">(</a><a id="2408" href="ledger.html#1676" class="Field">inputs</a> <a id="2415" href="ledger.html#2388" class="Bound">tr</a><a id="2417" class="Symbol">)</a> <a id="2419" class="Symbol">(</a><a id="2420" href="ledger.html#1712" class="Field">outputs</a> <a id="2428" href="ledger.html#2388" class="Bound">tr</a><a id="2430" class="Symbol">)</a>

<a id="2433" class="Comment">-- \bitcoinVersFive</a>


<a id="2455" class="Keyword">record</a> <a id="TXNew"></a><a id="2462" href="ledger.html#2462" class="Record">TXNew</a> <a id="2468" class="Symbol">:</a> <a id="2470" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="2474" class="Keyword">where</a>
  <a id="2482" class="Keyword">field</a>  <a id="TXNew.tx"></a><a id="2489" href="ledger.html#2489" class="Field">tx</a>       <a id="2498" class="Symbol">:</a> <a id="2500" href="ledger.html#1641" class="Record">TXUnsignedNew</a>
         <a id="TXNew.cor"></a><a id="2523" href="ledger.html#2523" class="Field">cor</a>      <a id="2532" class="Symbol">:</a> <a id="2534" href="ledger.html#1478" class="Function">txFieldList2TotalAmountNew</a> <a id="2561" class="Symbol">(</a><a id="2562" href="ledger.html#1676" class="Field">inputs</a> <a id="2569" href="ledger.html#2489" class="Field">tx</a><a id="2571" class="Symbol">)</a> <a id="2573" href="Data.Nat.Base.html#1679" class="Function Operator">≥</a> <a id="2575" href="ledger.html#1478" class="Function">txFieldList2TotalAmountNew</a> <a id="2602" class="Symbol">(</a><a id="2603" href="ledger.html#1712" class="Field">outputs</a> <a id="2611" href="ledger.html#2489" class="Field">tx</a><a id="2613" class="Symbol">)</a>
         <a id="TXNew.nonEmpt"></a><a id="2624" href="ledger.html#2624" class="Field">nonEmpt</a>  <a id="2633" class="Symbol">:</a> <a id="2635" href="libraries.listLib.html#8204" class="Function">NonNil</a> <a id="2642" class="Symbol">(</a><a id="2643" href="ledger.html#1676" class="Field">inputs</a> <a id="2650" href="ledger.html#2489" class="Field">tx</a><a id="2652" class="Symbol">)</a> <a id="2654" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="2656" href="libraries.listLib.html#8204" class="Function">NonNil</a> <a id="2663" class="Symbol">(</a><a id="2664" href="ledger.html#1712" class="Field">outputs</a> <a id="2672" href="ledger.html#2489" class="Field">tx</a><a id="2674" class="Symbol">)</a>
         <a id="TXNew.sig"></a><a id="2685" href="ledger.html#2685" class="Field">sig</a>      <a id="2694" class="Symbol">:</a> <a id="2696" href="ledger.html#2344" class="Function">tx2SignNew</a> <a id="2707" href="ledger.html#2489" class="Field">tx</a>

<a id="2711" class="Keyword">open</a> <a id="2716" href="ledger.html#2462" class="Module">TXNew</a> <a id="2722" class="Keyword">public</a>


<a id="2731" class="Comment">--record for a ledger</a>
<a id="2753" class="Keyword">record</a> <a id="ledgerEntryNew"></a><a id="2760" href="ledger.html#2760" class="Record">ledgerEntryNew</a> <a id="2775" class="Symbol">:</a> <a id="2777" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="2781" class="Keyword">where</a>   
  <a id="2792" class="Keyword">constructor</a> <a id="ledgerEntrNew"></a><a id="2804" href="ledger.html#2804" class="InductiveConstructor">ledgerEntrNew</a>
  <a id="2820" class="Keyword">field</a> <a id="ledgerEntryNew.ins"></a><a id="2826" href="ledger.html#2826" class="Field">ins</a>       <a id="2836" class="Symbol">:</a> <a id="2838" href="instruction.html#1859" class="Function">BitcoinScript</a>
        <a id="ledgerEntryNew.amount"></a><a id="2860" href="ledger.html#2860" class="Field">amount</a>    <a id="2870" class="Symbol">:</a> <a id="2872" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>

<a id="2875" class="Keyword">open</a> <a id="2880" href="ledger.html#2760" class="Module">ledgerEntryNew</a> <a id="2895" class="Keyword">public</a>

<a id="2903" class="Keyword">record</a> <a id="LedgerNew"></a><a id="2910" href="ledger.html#2910" class="Record">LedgerNew</a> <a id="2920" class="Symbol">:</a> <a id="2922" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="2926" class="Keyword">where</a>
  <a id="2934" class="Keyword">constructor</a> <a id="ledger"></a><a id="2946" href="ledger.html#2946" class="InductiveConstructor">ledger</a>
  <a id="2955" class="Keyword">field</a>
     <a id="LedgerNew.entries"></a><a id="2966" href="ledger.html#2966" class="Field">entries</a>        <a id="2981" class="Symbol">:</a> <a id="2983" class="Symbol">(</a><a id="2984" href="ledger.html#2984" class="Bound">addr</a> <a id="2989" class="Symbol">:</a> <a id="2991" href="basicBitcoinDataType.html#714" class="Function">Address</a><a id="2998" class="Symbol">)</a> <a id="3000" class="Symbol">→</a> <a id="3002" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="3008" href="ledger.html#2760" class="Record">ledgerEntryNew</a>
     <a id="LedgerNew.currentTime"></a><a id="3028" href="ledger.html#3028" class="Field">currentTime</a>    <a id="3043" class="Symbol">:</a> <a id="3045" href="basicBitcoinDataType.html#662" class="Function">Time</a>
<a id="3050" class="Keyword">open</a> <a id="3055" href="ledger.html#2910" class="Module">LedgerNew</a> <a id="3065" class="Keyword">public</a>


<a id="3074" class="Comment">--record for transaction entry</a>
<a id="3105" class="Keyword">record</a> <a id="TXEntryNew"></a><a id="3112" href="ledger.html#3112" class="Record">TXEntryNew</a> <a id="3123" class="Symbol">:</a> <a id="3125" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="3129" class="Keyword">where</a>
  <a id="3137" class="Keyword">constructor</a> <a id="txentryNew"></a><a id="3149" href="ledger.html#3149" class="InductiveConstructor">txentryNew</a>
  <a id="3162" class="Keyword">field</a> <a id="TXEntryNew.amount"></a><a id="3168" href="ledger.html#3168" class="Field">amount</a>              <a id="3188" class="Symbol">:</a> <a id="3190" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
        <a id="TXEntryNew.smartContract"></a><a id="3200" href="ledger.html#3200" class="Field">smartContract</a>       <a id="3220" class="Symbol">:</a> <a id="3222" href="instruction.html#1859" class="Function">BitcoinScript</a>
        <a id="TXEntryNew.address"></a><a id="3244" href="ledger.html#3244" class="Field">address</a>             <a id="3264" class="Symbol">:</a> <a id="3266" href="basicBitcoinDataType.html#714" class="Function">Address</a> <a id="3274" class="Comment">-- indentifiers for unspentTX outputs (UTXO) (Lists of UTXO)</a>

<a id="3336" class="Keyword">open</a> <a id="3341" href="ledger.html#3112" class="Module">TXEntryNew</a> <a id="3352" class="Keyword">public</a>


<a id="testLedgerNewEntries"></a><a id="3361" href="ledger.html#3361" class="Function">testLedgerNewEntries</a> <a id="3382" class="Symbol">:</a> <a id="3384" href="basicBitcoinDataType.html#714" class="Function">Address</a> <a id="3392" class="Symbol">→</a> <a id="3394" href="Agda.Builtin.Maybe.html#136" class="Datatype">Maybe</a> <a id="3400" href="ledger.html#2760" class="Record">ledgerEntryNew</a>
<a id="3415" href="ledger.html#3361" class="Function">testLedgerNewEntries</a> <a id="3436" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a> <a id="3441" class="Symbol">=</a> <a id="3443" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3448" class="Symbol">(</a><a id="3449" href="ledger.html#2804" class="InductiveConstructor">ledgerEntrNew</a> <a id="3463" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="3466" class="Number">50</a><a id="3468" class="Symbol">)</a>
<a id="3470" href="ledger.html#3361" class="Function">testLedgerNewEntries</a> <a id="3491" class="Symbol">(</a><a id="3492" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="3496" href="Agda.Builtin.Nat.html#210" class="InductiveConstructor">zero</a><a id="3500" class="Symbol">)</a> <a id="3502" class="Symbol">=</a> <a id="3504" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="3509" class="Symbol">(</a><a id="3510" href="ledger.html#2804" class="InductiveConstructor">ledgerEntrNew</a> <a id="3524" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a> <a id="3527" class="Number">80</a><a id="3529" class="Symbol">)</a>
<a id="3531" href="ledger.html#3361" class="Function">testLedgerNewEntries</a> <a id="3552" class="Symbol">(</a><a id="3553" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="3557" class="Symbol">(</a><a id="3558" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="3562" href="ledger.html#3562" class="Bound">x</a><a id="3563" class="Symbol">))</a> <a id="3566" class="Symbol">=</a> <a id="3568" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>

<a id="testLedgerNew"></a><a id="3577" href="ledger.html#3577" class="Function">testLedgerNew</a> <a id="3591" class="Symbol">:</a> <a id="3593" href="ledger.html#2910" class="Record">LedgerNew</a>
<a id="3603" href="ledger.html#3577" class="Function">testLedgerNew</a> <a id="3617" class="Symbol">.</a><a id="3618" href="ledger.html#2966" class="Field">entries</a> <a id="3626" class="Symbol">=</a> <a id="3628" href="ledger.html#3361" class="Function">testLedgerNewEntries</a>
<a id="3649" href="ledger.html#3577" class="Function">testLedgerNew</a> <a id="3663" class="Symbol">.</a><a id="3664" href="ledger.html#3028" class="Field">currentTime</a> <a id="3676" class="Symbol">=</a> <a id="3678" class="Number">31</a>

<a id="3682" class="Comment">-- record for transaction</a>
<a id="3708" class="Keyword">record</a> <a id="transactionNew"></a><a id="3715" href="ledger.html#3715" class="Record">transactionNew</a> <a id="3730" class="Symbol">:</a> <a id="3732" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="3736" class="Keyword">where</a> 
  <a id="3745" class="Keyword">constructor</a> <a id="transactNew"></a><a id="3757" href="ledger.html#3757" class="InductiveConstructor">transactNew</a>
  <a id="3771" class="Keyword">field</a> <a id="transactionNew.txid"></a><a id="3777" href="ledger.html#3777" class="Field">txid</a>      <a id="3787" class="Symbol">:</a> <a id="3789" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
        <a id="transactionNew.inputs"></a><a id="3799" href="ledger.html#3799" class="Field">inputs</a>    <a id="3809" class="Symbol">:</a> <a id="3811" href="ledger.html#3112" class="Record">TXEntryNew</a>
        <a id="transactionNew.outputs"></a><a id="3830" href="ledger.html#3830" class="Field">outputs</a>   <a id="3840" class="Symbol">:</a> <a id="3842" href="ledger.html#3112" class="Record">TXEntryNew</a>

<a id="3854" class="Keyword">open</a> <a id="3859" href="ledger.html#3715" class="Module">transactionNew</a> <a id="3874" class="Keyword">public</a>

<a id="3882" class="Comment">-- function that is used to check if the coins go to the same address</a>
<a id="processLedger"></a><a id="3952" href="ledger.html#3952" class="Function">processLedger</a> <a id="3966" class="Symbol">:</a> <a id="3968" href="ledger.html#2910" class="Record">LedgerNew</a> <a id="3978" class="Symbol">→</a>  <a id="3981" href="ledger.html#3715" class="Record">transactionNew</a>  <a id="3997" class="Symbol">→</a> <a id="3999" href="ledger.html#2910" class="Record">LedgerNew</a>
<a id="4009" href="ledger.html#3952" class="Function">processLedger</a> <a id="4023" href="ledger.html#4023" class="Bound">oldLed</a>
              <a id="4044" class="Symbol">(</a><a id="4045" href="ledger.html#3757" class="InductiveConstructor">transactNew</a> <a id="4057" href="ledger.html#4057" class="Bound">txid₁</a> <a id="4063" class="Symbol">(</a><a id="4064" href="ledger.html#3149" class="InductiveConstructor">txentryNew</a> <a id="4075" href="ledger.html#4075" class="Bound">amount₁</a> <a id="4083" href="ledger.html#4083" class="Bound">smartContract₁</a> <a id="4098" href="ledger.html#4098" class="Bound">recipientAddress</a><a id="4114" class="Symbol">)</a>
                <a id="4132" class="Symbol">(</a><a id="4133" href="ledger.html#3149" class="InductiveConstructor">txentryNew</a> <a id="4144" href="ledger.html#4144" class="Bound">amount₂</a> <a id="4152" href="ledger.html#4152" class="Bound">smartContract₂</a> <a id="4167" href="ledger.html#4167" class="Bound">desinntationAddress</a><a id="4186" class="Symbol">))</a>
              <a id="4203" class="Symbol">.</a><a id="4204" href="ledger.html#2966" class="Field">entries</a> <a id="4212" href="ledger.html#4212" class="Bound">addr</a>
            <a id="4229" class="Symbol">=</a>  <a id="4232" href="libraries.boolLib.html#229" class="Function Operator">if</a> <a id="4235" class="Symbol">(</a><a id="4236" href="ledger.html#4212" class="Bound">addr</a> <a id="4241" href="libraries.natLib.html#736" class="Function Operator">==b</a> <a id="4245" href="ledger.html#4098" class="Bound">recipientAddress</a><a id="4261" class="Symbol">)</a>
               <a id="4278" href="libraries.boolLib.html#229" class="Function Operator">then</a> <a id="4283" href="Agda.Builtin.Maybe.html#195" class="InductiveConstructor">nothing</a>
               <a id="4306" href="libraries.boolLib.html#229" class="Function Operator">else</a> <a id="4311" class="Symbol">(</a> <a id="4313" href="libraries.boolLib.html#229" class="Function Operator">if</a> <a id="4316" class="Symbol">(</a><a id="4317" href="ledger.html#4212" class="Bound">addr</a> <a id="4322" href="libraries.natLib.html#736" class="Function Operator">==b</a> <a id="4326" href="ledger.html#4167" class="Bound">desinntationAddress</a><a id="4345" class="Symbol">)</a>
                      <a id="4369" href="libraries.boolLib.html#229" class="Function Operator">then</a>  <a id="4375" href="Agda.Builtin.Maybe.html#174" class="InductiveConstructor">just</a> <a id="4380" class="Symbol">(</a><a id="4381" href="ledger.html#2804" class="InductiveConstructor">ledgerEntrNew</a> <a id="4395" href="ledger.html#4152" class="Bound">smartContract₂</a>  <a id="4411" href="ledger.html#4144" class="Bound">amount₂</a><a id="4418" class="Symbol">)</a>
                      <a id="4442" href="libraries.boolLib.html#229" class="Function Operator">else</a>  <a id="4448" href="ledger.html#4023" class="Bound">oldLed</a> <a id="4455" class="Symbol">.</a><a id="4456" href="ledger.html#2966" class="Field">entries</a> <a id="4464" href="ledger.html#4212" class="Bound">addr</a> <a id="4469" class="Symbol">)</a>
<a id="4471" href="ledger.html#3952" class="Function">processLedger</a> <a id="4485" href="ledger.html#4485" class="Bound">oldLed</a> <a id="4492" href="ledger.html#4492" class="Bound">trans</a> <a id="4498" class="Symbol">.</a><a id="4499" href="ledger.html#3028" class="Field">currentTime</a> <a id="4511" class="Symbol">=</a> <a id="4513" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="4517" class="Symbol">(</a><a id="4518" href="ledger.html#4485" class="Bound">oldLed</a> <a id="4525" class="Symbol">.</a><a id="4526" href="ledger.html#3028" class="Field">currentTime</a><a id="4537" class="Symbol">)</a>

<a id="tx2MsgNew"></a><a id="4540" href="ledger.html#4540" class="Function">tx2MsgNew</a> <a id="4550" class="Symbol">:</a> <a id="4552" href="ledger.html#3715" class="Record">transactionNew</a> <a id="4567" class="Symbol">→</a> <a id="4569" href="basicBitcoinDataType.html#854" class="Datatype">Msg</a>
<a id="4573" href="ledger.html#4540" class="Function">tx2MsgNew</a>  <a id="4584" href="ledger.html#4584" class="Bound">t</a>  <a id="4587" class="Symbol">=</a> <a id="4589" href="basicBitcoinDataType.html#873" class="InductiveConstructor">nat</a> <a id="4593" class="Symbol">(</a><a id="4594" href="ledger.html#3777" class="Field">txid</a> <a id="4599" href="ledger.html#4584" class="Bound">t</a><a id="4600" class="Symbol">)</a>
</pre></body></html>