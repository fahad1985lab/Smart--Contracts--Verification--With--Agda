<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>hoareTripleStack</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="basicBitcoinDataType.html" class="Module">basicBitcoinDataType</a>

<a id="35" class="Keyword">module</a> <a id="42" href="hoareTripleStack.html" class="Module">hoareTripleStack</a> <a id="59" class="Symbol">(</a><a id="60" href="hoareTripleStack.html#60" class="Bound">param</a> <a id="66" class="Symbol">:</a> <a id="68" href="basicBitcoinDataType.html#1548" class="Record">GlobalParameters</a><a id="84" class="Symbol">)</a> <a id="86" class="Keyword">where</a>

<a id="93" class="Keyword">open</a> <a id="98" class="Keyword">import</a> <a id="105" href="Data.Nat.html" class="Module">Data.Nat</a>  <a id="115" class="Keyword">renaming</a> <a id="124" class="Symbol">(</a><a id="125" href="Data.Nat.Base.html#1535" class="Datatype Operator">_≤_</a> <a id="129" class="Symbol">to</a> <a id="132" class="Datatype Operator">_≤&#39;_</a> <a id="137" class="Symbol">;</a> <a id="139" href="Data.Nat.Base.html#1645" class="Function Operator">_&lt;_</a> <a id="143" class="Symbol">to</a> <a id="146" class="Function Operator">_&lt;&#39;_</a><a id="150" class="Symbol">)</a>
<a id="152" class="Keyword">open</a> <a id="157" class="Keyword">import</a> <a id="164" href="Data.List.html" class="Module">Data.List</a> <a id="174" class="Keyword">hiding</a> <a id="181" class="Symbol">(</a><a id="182" href="Data.List.Base.html#1810" class="Function Operator">_++_</a><a id="186" class="Symbol">)</a>
<a id="188" class="Keyword">open</a> <a id="193" class="Keyword">import</a> <a id="200" href="Data.Sum.html" class="Module">Data.Sum</a>
<a id="209" class="Keyword">open</a> <a id="214" class="Keyword">import</a> <a id="221" href="Data.Maybe.html" class="Module">Data.Maybe</a>
<a id="232" class="Keyword">open</a> <a id="237" class="Keyword">import</a> <a id="244" href="Data.Unit.html" class="Module">Data.Unit</a>  <a id="255" class="Keyword">hiding</a> <a id="262" class="Symbol">(</a><a id="263" href="Data.Unit.Base.html#1023" class="Record Operator">_≤_</a><a id="266" class="Symbol">)</a>
<a id="268" class="Keyword">open</a> <a id="273" class="Keyword">import</a> <a id="280" href="Data.Empty.html" class="Module">Data.Empty</a>
<a id="291" class="Keyword">open</a> <a id="296" class="Keyword">import</a> <a id="303" href="Data.Bool.html" class="Module">Data.Bool</a>  <a id="314" class="Keyword">hiding</a> <a id="321" class="Symbol">(</a><a id="322" href="Data.Bool.Base.html#672" class="Datatype Operator">_≤_</a> <a id="326" class="Symbol">;</a> <a id="328" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a> <a id="342" class="Symbol">)</a> <a id="344" class="Keyword">renaming</a> <a id="353" class="Symbol">(</a><a id="354" href="Data.Bool.Base.html#986" class="Function Operator">_∧_</a> <a id="358" class="Symbol">to</a> <a id="361" class="Function Operator">_∧b_</a> <a id="366" class="Symbol">;</a> <a id="368" href="Data.Bool.Base.html#1044" class="Function Operator">_∨_</a> <a id="372" class="Symbol">to</a> <a id="375" class="Function Operator">_∨b_</a> <a id="380" class="Symbol">;</a> <a id="382" href="Data.Bool.Base.html#1451" class="Function">T</a> <a id="384" class="Symbol">to</a> <a id="387" class="Function">True</a><a id="391" class="Symbol">)</a>
<a id="393" class="Keyword">open</a> <a id="398" class="Keyword">import</a> <a id="405" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="420" class="Keyword">hiding</a> <a id="427" class="Symbol">(</a><a id="428" href="Data.Bool.Base.html#672" class="Datatype Operator">_≤_</a> <a id="432" class="Symbol">;</a> <a id="434" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a> <a id="448" class="Symbol">)</a> <a id="450" class="Keyword">renaming</a> <a id="459" class="Symbol">(</a><a id="460" href="Data.Bool.Base.html#986" class="Function Operator">_∧_</a> <a id="464" class="Symbol">to</a> <a id="467" class="Function Operator">_∧b_</a> <a id="472" class="Symbol">;</a> <a id="474" href="Data.Bool.Base.html#1044" class="Function Operator">_∨_</a> <a id="478" class="Symbol">to</a> <a id="481" class="Function Operator">_∨b_</a> <a id="486" class="Symbol">;</a> <a id="488" href="Data.Bool.Base.html#1451" class="Function">T</a> <a id="490" class="Symbol">to</a> <a id="493" class="Function">True</a><a id="497" class="Symbol">)</a>
<a id="499" class="Keyword">open</a> <a id="504" class="Keyword">import</a> <a id="511" href="Data.Product.html" class="Module">Data.Product</a> <a id="524" class="Keyword">renaming</a> <a id="533" class="Symbol">(</a><a id="534" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a> <a id="538" class="Symbol">to</a> <a id="541" class="InductiveConstructor Operator">_,,_</a> <a id="546" class="Symbol">)</a>
<a id="548" class="Keyword">open</a> <a id="553" class="Keyword">import</a> <a id="560" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="574" class="Keyword">hiding</a> <a id="581" class="Symbol">(</a><a id="582" href="Data.Nat.Base.html#1535" class="Datatype Operator">_≤_</a><a id="585" class="Symbol">)</a>
<a id="587" class="Comment">-- open import Data.List.NonEmpty hiding (head)</a>

<a id="636" class="Keyword">import</a> <a id="643" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="681" class="Symbol">as</a> <a id="684" class="Module">Eq</a>
<a id="687" class="Keyword">open</a> <a id="692" href="Relation.Binary.PropositionalEquality.html" class="Module">Eq</a> <a id="695" class="Keyword">using</a> <a id="701" class="Symbol">(</a><a id="702" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">_≡_</a><a id="705" class="Symbol">;</a> <a id="707" href="Agda.Builtin.Equality.html#208" class="InductiveConstructor">refl</a><a id="711" class="Symbol">;</a> <a id="713" href="Relation.Binary.PropositionalEquality.Core.html#1130" class="Function">cong</a><a id="717" class="Symbol">;</a> <a id="719" class="Keyword">module</a> <a id="726" href="Relation.Binary.PropositionalEquality.Core.html#2708" class="Module">≡-Reasoning</a><a id="737" class="Symbol">;</a> <a id="739" href="Relation.Binary.PropositionalEquality.Core.html#1684" class="Function">sym</a><a id="742" class="Symbol">)</a>
<a id="744" class="Keyword">open</a> <a id="749" href="Relation.Binary.PropositionalEquality.Core.html#2708" class="Module">≡-Reasoning</a>
<a id="761" class="Keyword">open</a> <a id="766" class="Keyword">import</a> <a id="773" href="Agda.Builtin.Equality.html" class="Module">Agda.Builtin.Equality</a>
<a id="795" class="Comment">--open import Agda.Builtin.Equality.Rewrite</a>


<a id="841" class="Keyword">open</a> <a id="846" class="Keyword">import</a> <a id="853" href="libraries.listLib.html" class="Module">libraries.listLib</a>
<a id="871" class="Keyword">open</a> <a id="876" class="Keyword">import</a> <a id="883" href="libraries.natLib.html" class="Module">libraries.natLib</a>
<a id="900" class="Keyword">open</a> <a id="905" class="Keyword">import</a> <a id="912" href="libraries.boolLib.html" class="Module">libraries.boolLib</a>
<a id="930" class="Keyword">open</a> <a id="935" class="Keyword">import</a> <a id="942" href="libraries.andLib.html" class="Module">libraries.andLib</a>
<a id="959" class="Keyword">open</a> <a id="964" class="Keyword">import</a> <a id="971" href="libraries.miscLib.html" class="Module">libraries.miscLib</a>
<a id="989" class="Keyword">open</a> <a id="994" class="Keyword">import</a> <a id="1001" href="libraries.maybeLib.html" class="Module">libraries.maybeLib</a>
<a id="1020" class="Keyword">open</a> <a id="1025" class="Keyword">import</a> <a id="1032" href="libraries.emptyLib.html" class="Module">libraries.emptyLib</a>

<a id="1052" class="Keyword">open</a> <a id="1057" class="Keyword">import</a> <a id="1064" href="stack.html" class="Module">stack</a>
<a id="1070" class="Keyword">open</a> <a id="1075" class="Keyword">import</a> <a id="1082" href="stackPredicate.html" class="Module">stackPredicate</a>

<a id="1098" class="Keyword">open</a> <a id="1103" class="Keyword">import</a> <a id="1110" href="instruction.html" class="Module">instruction</a>
<a id="1122" class="Comment">-- open import ledger param</a>
<a id="1150" class="Keyword">open</a> <a id="1155" class="Keyword">import</a> <a id="1162" href="stackSemanticsInstructions.html" class="Module">stackSemanticsInstructions</a> <a id="1189" href="hoareTripleStack.html#60" class="Bound">param</a>

<a id="1196" class="Comment">--------------------------------------------------------------------------</a>
<a id="1271" class="Comment">--   defines hoare triples for stack functions</a>
<a id="1318" class="Comment">--   and that their correspondence to the full hoare triples for nonif instructions</a>
<a id="1402" class="Comment">---------------------------------------------------------------------------------------</a>



<a id="1493" class="Comment">-- Defines the condition for the stackfunction of an instruction</a>
<a id="1558" class="Comment">--   for the hoare truple based on φ ψ only to be correct</a>
<a id="1616" class="Comment">--</a>
<a id="1619" class="Comment">-- here we have a generic version which doesn&#39;t refer to an instruction</a>
<a id="1691" class="Comment">--  but just its stack partx</a>
<a id="1720" class="Comment">--</a>
<a id="1723" class="Comment">-- we later show that this implies the correctness of a</a>
<a id="1779" class="Comment">--  Hoare triple for that instruction</a>
<a id="1817" class="Comment">--  provided we have a non-if instruction</a>

<a id="1860" class="Keyword">record</a> <a id="&lt;_&gt;gˢ_&lt;_&gt;"></a><a id="1867" href="hoareTripleStack.html#1867" class="Record Operator">&lt;_&gt;gˢ_&lt;_&gt;</a> <a id="1877" class="Symbol">(</a><a id="1878" href="hoareTripleStack.html#1878" class="Bound">φ</a> <a id="1880" class="Symbol">:</a> <a id="1882" href="stackPredicate.html#939" class="Function">StackPredicate</a><a id="1896" class="Symbol">)</a> <a id="1898" class="Symbol">(</a><a id="1899" href="hoareTripleStack.html#1899" class="Bound">stackfun</a> <a id="1908" class="Symbol">:</a> <a id="1910" href="stack.html#1228" class="Function">StackTransformer</a><a id="1926" class="Symbol">)</a>
                       <a id="1951" class="Symbol">(</a><a id="1952" href="hoareTripleStack.html#1952" class="Bound">ψ</a> <a id="1954" class="Symbol">:</a> <a id="1956" href="stackPredicate.html#939" class="Function">StackPredicate</a><a id="1970" class="Symbol">)</a> <a id="1972" class="Symbol">:</a> <a id="1974" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1978" class="Keyword">where</a>
  <a id="1986" class="Keyword">constructor</a> <a id="hoareTripleStackGen"></a><a id="1998" href="hoareTripleStack.html#1998" class="InductiveConstructor">hoareTripleStackGen</a> <a id="2018" class="Comment">-- corrStackPartGeneric</a>
  <a id="2044" class="Keyword">field</a>
    <a id="&lt;_&gt;gˢ_&lt;_&gt;.==&gt;stg"></a><a id="2054" href="hoareTripleStack.html#2054" class="Field">==&gt;stg</a> <a id="2061" class="Symbol">:</a> <a id="2063" class="Symbol">(</a><a id="2064" href="hoareTripleStack.html#2064" class="Bound">time</a> <a id="2069" class="Symbol">:</a> <a id="2071" href="basicBitcoinDataType.html#694" class="Function">Time</a><a id="2075" class="Symbol">)(</a><a id="2077" href="hoareTripleStack.html#2077" class="Bound">msg</a> <a id="2081" class="Symbol">:</a> <a id="2083" href="basicBitcoinDataType.html#886" class="Datatype">Msg</a><a id="2086" class="Symbol">)(</a><a id="2088" href="hoareTripleStack.html#2088" class="Bound">s</a> <a id="2090" class="Symbol">:</a> <a id="2092" href="stack.html#772" class="Function">Stack</a><a id="2097" class="Symbol">)</a>
            <a id="2111" class="Symbol">→</a> <a id="2113" href="hoareTripleStack.html#1878" class="Bound">φ</a> <a id="2115" href="hoareTripleStack.html#2064" class="Bound">time</a> <a id="2120" href="hoareTripleStack.html#2077" class="Bound">msg</a> <a id="2124" href="hoareTripleStack.html#2088" class="Bound">s</a>
            <a id="2138" class="Symbol">→</a> <a id="2140" href="libraries.maybeLib.html#967" class="Function">liftPred2Maybe</a> <a id="2155" class="Symbol">(</a><a id="2156" href="hoareTripleStack.html#1952" class="Bound">ψ</a>  <a id="2159" href="hoareTripleStack.html#2064" class="Bound">time</a> <a id="2164" href="hoareTripleStack.html#2077" class="Bound">msg</a><a id="2167" class="Symbol">)</a> <a id="2169" class="Symbol">(</a><a id="2170" href="hoareTripleStack.html#1899" class="Bound">stackfun</a> <a id="2179" href="hoareTripleStack.html#2064" class="Bound">time</a> <a id="2184" href="hoareTripleStack.html#2077" class="Bound">msg</a> <a id="2188" href="hoareTripleStack.html#2088" class="Bound">s</a><a id="2189" class="Symbol">)</a>
    <a id="&lt;_&gt;gˢ_&lt;_&gt;.&lt;==stg"></a><a id="2195" href="hoareTripleStack.html#2195" class="Field">&lt;==stg</a> <a id="2202" class="Symbol">:</a> <a id="2204" class="Symbol">(</a><a id="2205" href="hoareTripleStack.html#2205" class="Bound">time</a> <a id="2210" class="Symbol">:</a> <a id="2212" href="basicBitcoinDataType.html#694" class="Function">Time</a><a id="2216" class="Symbol">)(</a><a id="2218" href="hoareTripleStack.html#2218" class="Bound">msg</a> <a id="2222" class="Symbol">:</a> <a id="2224" href="basicBitcoinDataType.html#886" class="Datatype">Msg</a><a id="2227" class="Symbol">)(</a><a id="2229" href="hoareTripleStack.html#2229" class="Bound">s</a> <a id="2231" class="Symbol">:</a> <a id="2233" href="stack.html#772" class="Function">Stack</a><a id="2238" class="Symbol">)</a>
            <a id="2252" class="Symbol">→</a> <a id="2254" href="libraries.maybeLib.html#967" class="Function">liftPred2Maybe</a> <a id="2269" class="Symbol">(</a><a id="2270" href="hoareTripleStack.html#1952" class="Bound">ψ</a>  <a id="2273" href="hoareTripleStack.html#2205" class="Bound">time</a> <a id="2278" href="hoareTripleStack.html#2218" class="Bound">msg</a><a id="2281" class="Symbol">)</a> <a id="2283" class="Symbol">(</a><a id="2284" href="hoareTripleStack.html#1899" class="Bound">stackfun</a> <a id="2293" href="hoareTripleStack.html#2205" class="Bound">time</a> <a id="2298" href="hoareTripleStack.html#2218" class="Bound">msg</a> <a id="2302" href="hoareTripleStack.html#2229" class="Bound">s</a><a id="2303" class="Symbol">)</a>
            <a id="2317" class="Symbol">→</a> <a id="2319" href="hoareTripleStack.html#1878" class="Bound">φ</a> <a id="2321" href="hoareTripleStack.html#2205" class="Bound">time</a> <a id="2326" href="hoareTripleStack.html#2218" class="Bound">msg</a> <a id="2330" href="hoareTripleStack.html#2229" class="Bound">s</a>
<a id="2332" class="Keyword">open</a> <a id="2337" href="hoareTripleStack.html#1867" class="Module Operator">&lt;_&gt;gˢ_&lt;_&gt;</a> <a id="2347" class="Keyword">public</a>

<a id="2355" class="Comment">{-
HoareTripleStackGen : (φ : StackPredicate) (stackfun : StackTransformer) (ψ : StackPredicate)
                      → Set
HoareTripleStackGen φ stackfun ψ  = &lt; φ &gt;gˢ stackfun &lt; ψ &gt;
-}</a>
<a id="2542" class="Comment">{-
-- The condition CorrectnessStackPartGeneric
--  instantiated for the stack part of an instruction
--     is only really correct for non-if instructions
CorrectnessStackPartOfInstr : (instr : InstructionAll)
                              (φ ψ : StackPredicate)
                              → Set
CorrectnessStackPartOfInstr instr φ ψ = &lt; φ &gt;gˢ ⟦ instr ∷ []  ⟧stack &lt; ψ &gt;
-}</a>

<a id="2921" class="Comment">-- Hoare triple  with stack instructions</a>
<a id="&lt;_&gt;stack_&lt;_&gt;"></a><a id="2962" href="hoareTripleStack.html#2962" class="Function Operator">&lt;_&gt;stack_&lt;_&gt;</a> <a id="2975" class="Symbol">:</a> <a id="2977" href="stackPredicate.html#939" class="Function">StackPredicate</a> <a id="2992" class="Symbol">→</a> <a id="2994" href="instruction.html#2197" class="Function">BitcoinScript</a> <a id="3008" class="Symbol">→</a> <a id="3010" href="stackPredicate.html#939" class="Function">StackPredicate</a> <a id="3025" class="Symbol">→</a> <a id="3027" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="3031" href="hoareTripleStack.html#2962" class="Function Operator">&lt;</a> <a id="3033" href="hoareTripleStack.html#3033" class="Bound">φ</a> <a id="3035" href="hoareTripleStack.html#2962" class="Function Operator">&gt;stack</a> <a id="3042" href="hoareTripleStack.html#3042" class="Bound">prog</a> <a id="3047" href="hoareTripleStack.html#2962" class="Function Operator">&lt;</a> <a id="3049" href="hoareTripleStack.html#3049" class="Bound">ψ</a> <a id="3051" href="hoareTripleStack.html#2962" class="Function Operator">&gt;</a> <a id="3053" class="Symbol">=</a> <a id="3055" href="hoareTripleStack.html#1867" class="Record Operator">&lt;</a> <a id="3057" href="hoareTripleStack.html#3033" class="Bound">φ</a> <a id="3059" href="hoareTripleStack.html#1867" class="Record Operator">&gt;gˢ</a> <a id="3063" href="stackSemanticsInstructions.html#2310" class="Function Operator">⟦</a> <a id="3065" href="hoareTripleStack.html#3042" class="Bound">prog</a>  <a id="3071" href="stackSemanticsInstructions.html#2310" class="Function Operator">⟧stack</a>  <a id="3079" href="hoareTripleStack.html#1867" class="Record Operator">&lt;</a> <a id="3081" href="hoareTripleStack.html#3049" class="Bound">ψ</a> <a id="3083" href="hoareTripleStack.html#1867" class="Record Operator">&gt;</a>
</pre></body></html>